<?php

use yii\helpers\Url;
use yii\helpers\Html;
use yii\widgets\ActiveForm;
use kartik\date\DatePicker;
use kartik\datetime\DateTimePicker;

$Url = Url::to(['site/parada']);

?>

<div class="fechas-form">

    <?php
        $form = ActiveForm::begin([
            'id' => 'fechas-form',
            'options' => [
                'autocomplete' => 'off',
            ],
        ]);
?>

    <input type="hidden" id="cantdias" name="cantdias">
    <input type="hidden" id="url" value="<?= $Url ?>">
	<input type="hidden" id="type_service" name="type">
	
    <div class="row">

        <!--div align="center" id="tarifa" class="col-lg-12" style="margin-bottom: 20px; font-weight: bold;">TARIFA PREMIUM</div-->

        <div class="col-lg-8 col-xs-8">
            <label id="lbl" class="control-label lb" style="font-size: 0.8em">Fecha de Recogida</label>
        </div>

        <div class="col-lg-4 col-xs-4" style="margin-left: -20px">
            <label id="lbl1" class="control-label lb h" style="font-size: 0.8em">Hora</label>
        </div>        

        <div class="col-lg-7 col-xs-7"> 
            <?= $form->field($model, 'fecha_entrada')->textInput(['readonly' => true])->label(false) ?>
        </div>

        <div class="col-lg-5 col-xs-5">  
            <?= $form->field($model, 'hora_entrada')->textInput(['readonly' => true])->label(false) ?>
        </div> 

        <div class="col-lg-8 col-xs-8" style="margin-top: 10px">
            <label id="lbl2" class="control-label lb" style="font-size: 0.8em">Fecha de Devolución</label>
        </div>
        <div class="col-lg-4 col-xs-4" style="margin-left: -20px; margin-top: 10px">
            <label id="lbl3" class="control-label lb h" style="font-size: 0.8em">Hora</label>
        </div>          

        <div class="col-lg-7 col-xs-7">   
            <?= $form->field($model, 'fecha_salida')->textInput(['readonly' => true])->label(false) ?>
        </div>

        <div class="col-lg-5 col-xs-5">   
            <?= $form->field($model, 'hora_salida')->textInput(['readonly' => true])->label(false) ?>
        </div>

        <hr id="hr" style="border:none; width: 90%; margin-top: 0px; border-radius: 4px">

        <!--div class="img-min" id="precio-tarifa" style="color: #fff; margin-top: 0px; padding-top: 18px; font-size: 2em; border-radius: 10px; width: 180px; height: 90px"><div id="costo" style="display: inline;"></div> €</div-->                


        
		
		<!--Inicio de planes-->
		
		<div class="col-lg-12 pack-container" style="border: 1px solid #B0CB21; border-radius: 5px; display: flex;align-items: center;justify-content: space-between;padding: 10px;margin: 10px 0;background: #eee;">
		<div class="col-lg-2" style="">				
				<div class="counter_container" style="border: 1px solid #B0CB21;    width: 160px;height: 160px;background: #fff;">
				  <div class="counter__text">
					<div class="icon"><img class="counter__icon" src="/aparcatest/images/bronce.png" alt=""></div>
				  </div>
					<div class="counter__description">STANDAR</div>
				</div>							
			</div>
			
			<div class="col-lg-2" style="">				
				<div class="counter_container" style="border: 1px solid #B0CB21;    width: 160px;height: 160px;background: #fff;">
				  <div class="counter__text">
					<div class="icon"><img class="counter__icon" src="/aparcatest/images/chofer1.png" alt=""></div>
					
				  </div>
					<div class="counter__description">Recogida por<br> chofer</div>
				</div>							
			</div>
			
			<div class="col-lg-2" style="display: flex;align-items: center;justify-content: center;flex-direction: column;">
					<div class="counter_container"  style="border: 1px solid #B0CB21;    width: 160px;height: 160px;background: #fff;">
				  <div class="counter__text">
					<div class="icon"><img class="counter__icon" src="/aparcatest/images/car.png" alt=""></div>
				  </div>
				</div>		
			</div>
			
			<div class="col-lg-2" style="">				
				<h4>Servicios</h4>
				<p>- Parking exterior</p>
			</div>
			
			<div class="col-lg-2"style="display: flex;flex-direction: column;justify-content: center;align-items: center;">			
				<div id="costo" style="font-weight: 700; margin:5px 0px; font-size: 2rem;"></div> 
				<button type="button" id="bronce" style="background-color: #B0CB21" class="btn">Contratar</button>
			</div>
		</div>
				
		<div class="col-lg-12 pack-container" style="border: 1px solid #B0CB21; border-radius: 5px; display: flex;align-items: center;justify-content: space-between;padding: 10px;margin: 10px 0;background: #eee;">
		<div class="col-lg-2" style="">				
				<div class="counter_container" style="border: 1px solid #B0CB21;    width: 160px;height: 160px;background: #fff;">
				  <div class="counter__text">
					<div class="icon"><img class="counter__icon" src="/aparcatest/images/plata.png" alt=""></div>
				  </div>
					<div class="counter__description">PREMIUM</div>
				</div>							
			</div>
			
			<div class="col-lg-2" style="">				
				<div class="counter_container " style="border: 1px solid #B0CB21;    width: 160px;height: 160px;background: #fff;">
				  <div class="counter__text">
					<div class="icon"><img class="counter__icon" src="/aparcatest/images/chofer1.png" alt=""></div>
					
				  </div>
					<div class="counter__description">Recogida por<br> chofer</div>
				</div>							
			</div>
			
			<div class="col-lg-2" style="display: flex;align-items: center;justify-content: center;flex-direction: column;">
					<div class="counter_container" style="border: 1px solid #B0CB21;    width: 160px;height: 160px;background: #fff;">
				  <div class="counter__text">
					<div class="icon"><img class="counter__icon" src="/aparcatest/images/garage-car.png" alt=""></div>
				  </div>
				</div>		
			</div>
			
			<div class="col-lg-2" style="">				
				<h4>Servicios</h4>
				<p>- Lavado exterior cortesia</p>
				<p>- Parking techado</p>
			</div>
			
			<div class="col-lg-2"style="display: flex;flex-direction: column;justify-content: center;align-items: center;">			
				<div id="costo_t" style="font-weight: 700; margin:5px 0px; font-size: 2rem;"></div> 
				<button type="button" id="plata" class="btn" style="background-color: #B0CB21">Contratar</button>
			</div>
		</div>
		
		<div class="col-lg-12 pack-container" style="border: 1px solid #B0CB21; border-radius: 5px; display: flex;align-items: center;justify-content: space-between;padding: 10px;margin: 10px 0;background: #eee;">
		<div class="col-lg-2" style="">				
				<div class="counter_container" style="border: 1px solid #B0CB21;    width: 160px;height: 160px;background: #fff;">
				  <div class="counter__text">
					<div class="icon"><img class="counter__icon" src="/aparcatest/images/oro.png" alt=""></div>
				  </div>
					<div class="counter__description">PRIORITY</div>
				</div>							
			</div>
			
			<div class="col-lg-2" style="">				
				<div class="counter_container" style="border: 1px solid #B0CB21;    width: 160px;height: 160px;background: #fff;">
				  <div class="counter__text">
					<div class="icon"><img class="counter__icon" src="/aparcatest/images/chofer1.png" alt=""></div>
					
				  </div>
					<div class="counter__description">Recogida por<br> chofer</div>
				</div>							
			</div>
			
			<div class="col-lg-2" style="display: flex;align-items: center;justify-content: center;flex-direction: column;">
					<div class="counter_container" style="border: 1px solid #B0CB21;    width: 160px;height: 160px;background: #fff;">
				  <div class="counter__text">
					<div class="icon"><img class="counter__icon" src="/aparcatest/images/interior.png" alt=""></div>
				  </div>
				</div>		
			</div>
			
			<div class="col-lg-2" style="">				
				<h4>Servicios</h4>
				<p>- Lavado interior</p>
				<p>- Lavado exterior</p>
				<p>- Parking interior</p>
			</div>
			
			<div class="col-lg-2"style="display: flex;flex-direction: column;justify-content: center;align-items: center;">			
				<div id="costo_i" style="font-weight: 700; margin:5px 0px; font-size: 2rem;"></div> 
				<button type="button" id="oro" class="btn" style="background-color: #B0CB21">Contratar</button>
			</div>
		</div>

		<!-- Fin plan -->
		
		<div align="right" class="col-lg-12">
            <br>
            <div class="form-group">
                <?= Html::submitButton('Procesar Reserva', ['id' => 'boton-reserva', 'class' => 'btn btn-success btn-block', 'disabled' => true]) ?>
            </div>
            <?= Html::img('@web/images/alert.png', ['class' => 'img img-responsive img-alert', 'style' => 'display:none']) ?><div class="informe-texto" id="informe" style="display: none">Revise las fechas seleccionadas</div>

            <?= Html::img('@web/images/alert.png', ['class' => 'img img-responsive img-alert-parada', 'style' => 'display:none']) ?><div class="informe-texto" id="informe_parada" style="display: none">No Existe Disponibilidad para las Fechas</div>            
            
        </div>

    </div>
    <?php ActiveForm::end(); ?>

</div>

<?php
$this->registerJs(" 

        $( document ).ready(function() { 

            valor = $('#costo-servicio').val();
            fecha_e = $('#fecha-in').val();
            fecha_s = $('#fecha-out').val();
            hora_e = $('#hora-in').val();
            hora_s = $('#hora-out').val();

            cdias = $('#cdias').val();

            $('#cantdias').val(cdias);

            $('#reservas-fecha_entrada').val(fecha_e);
            $('#reservas-fecha_salida').val(fecha_s);

            $('#reservas-hora_entrada').val(hora_e);
            $('#reservas-hora_salida').val(hora_s);            

            url = $('#url').val();

            $.ajax({
                type:'POST',
                url: url,
                data: { fecha_e: fecha_e, hora_e: hora_e, fecha_s: fecha_s, hora_s: hora_s },
                success: function(data) {
                    dato = data
                    if (data == 1) {                       
                        if ( (isNaN(valor)) || (valor == 0.00)  ) {
                            valor = '0.00'
                            $('#costo').html(valor);
                            document.getElementById('boton-reserva').style.display='none';
                            document.getElementById('reservas-fecha_entrada').style.display='none';
                            document.getElementById('reservas-fecha_salida').style.display='none';
                            document.getElementById('reservas-hora_entrada').style.display='none';
                            document.getElementById('reservas-hora_salida').style.display='none';
                            document.getElementById('precio-tarifa').style.display='none';
                            document.getElementById('hr').style.display='none';
                            document.getElementById('tarifa').style.display='none';
                            document.getElementById('lbl').style.display='none';
                            document.getElementById('lbl1').style.display='none';
                            document.getElementById('lbl2').style.display='none';
                            document.getElementById('lbl3').style.display='none';
                            $('#fecha_reserva').css('margin', '220px auto');
                            document.getElementById('informe').style.display='block';
                            $('.img-alert').css('display', 'block');
                        } else {
                            //$('#costo').html(valor);
							
							$('#costo').html(valor + ' €');
							costoT = parseFloat(valor) + parseFloat(5);
							$('#costo_t').html(costoT.toFixed(2) + ' €');
				
							costoI = parseFloat(valor) + parseFloat(34);
							$('#costo_i').html(costoI.toFixed(2) + ' €');
                            $('#fecha_reserva').css('margin', '50px auto');
                        }
                    } else {
                        if ( (isNaN(valor)) || (valor == 0.00)  ) {
                            document.getElementById('boton-reserva').style.display='none';
                            document.getElementById('reservas-fecha_entrada').style.display='none';
                            document.getElementById('reservas-fecha_salida').style.display='none';
                            document.getElementById('reservas-hora_entrada').style.display='none';
                            document.getElementById('reservas-hora_salida').style.display='none';
                            document.getElementById('precio-tarifa').style.display='none';
                            document.getElementById('hr').style.display='none';
                            document.getElementById('tarifa').style.display='none';
                            document.getElementById('lbl').style.display='none';
                            document.getElementById('lbl1').style.display='none';
                            document.getElementById('lbl2').style.display='none';
                            document.getElementById('lbl3').style.display='none';
                            $('#fecha_reserva').css('margin', '220px auto');
                            document.getElementById('informe').innerHTML=data;
                            document.getElementById('informe').style.display='block';
                            $('.img-alert').css('display', 'block');                            
                        } else {
                            document.getElementById('boton-reserva').style.display='none';
                            document.getElementById('reservas-fecha_entrada').style.display='none';
                            document.getElementById('reservas-fecha_salida').style.display='none';
                            document.getElementById('reservas-hora_entrada').style.display='none';
                            document.getElementById('reservas-hora_salida').style.display='none';
                            document.getElementById('precio-tarifa').style.display='none';
                            document.getElementById('hr').style.display='none';
                            document.getElementById('tarifa').style.display='none';
                            document.getElementById('lbl').style.display='none';
                            document.getElementById('lbl1').style.display='none';
                            document.getElementById('lbl2').style.display='none';
                            document.getElementById('lbl3').style.display='none'; 
                            $('#fecha_reserva').css('margin', '220px auto'); 
                            document.getElementById('informe_parada').innerHTML=data;
                            document.getElementById('informe_parada').style.display='block';
                            $('.img-alert-parada').css('display', 'block'); 
                        }
                    }
                }            
            });
			
			$('#bronce').click(function(){
				$('#oro, #plata').css('background-color', '#B0CB21');
				$(this).css('background-color', '#212529');
				$(this).css('color', '#FFFFFF');
				$('#type_service').val(0);
				$('#boton-reserva').attr('disabled', false);
			});
			$('#plata').click(function(){
				$('#oro, #bronce').css('background-color', '#B0CB21');
				$(this).css('background-color', '#212529');
				$(this).css('color', '#FFFFFF');
				$('#type_service').val(9);
				$('#boton-reserva').attr('disabled', false);
			});
			
			$('#oro').click(function(){
				$('#plata, #bronce').css('background-color', '#B0CB21');
				$(this).css('background-color', '#212529');
				$(this).css('color', '#FFFFFF');
				$('#type_service').val(12);
				$('#boton-reserva').attr('disabled', false);
			});
        });

    ");
?>
